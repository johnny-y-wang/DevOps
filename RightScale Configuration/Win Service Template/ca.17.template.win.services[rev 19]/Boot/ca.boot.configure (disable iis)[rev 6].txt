# Powershell 2.0
# Copyright (c) 2008-2013 RightScale, Inc, All Rights Reserved Worldwide.

$errorActionPreference = "Stop"
 
$CA_REBOOT = [environment]::GetEnvironmentVariable("CA_REBOOT","Machine")

# Add $env: to force execute input if this code is ever uncommented
if ([System.Convert]::ToBoolean($CA_REBOOT) -and !([System.Convert]::ToBoolean($env:CA_GLB_FORCE_EXECUTE))){
          
  write-host "Skipping after reboot."
  exit 0
}

$feature = get-windowsfeature -Name web-server

if ($feature.installstate -eq "Installed") 
{
    Write-Output "IIS is Installed"
    $IISStatus = get-service w3svc
    If ($IISStatus.Status -ne "Stopped")
    {
        Write-Output "IIS is running, stopping service"
        $IISStatus.Stop()   
    }
    Else
    {
        Write-Output "IIS is not running disabling service"
    }

    Set-Service -Name W3SVC -StartupType Disabled
    Write-Output "IIS is Disabled"
}
Else
{
    Write-Output "IIS is not installed"
}
