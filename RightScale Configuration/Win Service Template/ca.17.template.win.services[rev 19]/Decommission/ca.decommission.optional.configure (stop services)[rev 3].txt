#SERVICE LIST VARIABLE WILL BE A SCRIPT INPUT THAT LISTS ALL PRODUCTION WIN SERVICES

$ServiceList = $env:CA_SA_ARR_WIN_SERVICE_NAME
$waitStatus = "Stopped"
#SEPARATES WINDOWS SERVICE LIST INTO INDIVIDUAL OBJECTS FOR PROCESSING
foreach($WinServiceName in $ServiceList.split(","))
{
    $CurrentService = Get-Service $WinServiceName -ErrorAction SilentlyContinue


    #IF THE CURRENT SERVICE VARIABLE EXISTS, CONTINUE PROCESSING
    if($CurrentService -ne $null)
    {
        try
        {
            #CHECKS TO SEE IF THE SERVICE IS STOPPED ALREADY
            if($CurrentService.Status -eq "Stopped")
            {
                Write-Host $CurrentService.Name "is already stopped."
                Write-Host ""
            }
            else
            {
                "Stopping service: " + $CurrentService.Name
                stop-service $CurrentService.Name


                $service = Get-Service $CurrentService.Name
                $service.WaitForStatus($waitStatus, "00:02:00")

                #ONCE SERVICE STATUS == STOPPED, DISPLAY MESSAGE
                if($service.Status -eq "Stopped")
                {
                    Write-Host $service "has stopped successfully."
                    Write-Host ""
                }
            }
        }
        catch
        {
            "There is an error: $_"
            "Windows Service Script Failure."

            exit 1
        }
    }
    #HANDLE CASE WHERE SERVICE ISN'T FOUND
    else
    {
        Write-Host "Service Not Found:" $WinServiceName
        
    }
}
